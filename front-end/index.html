<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reconhecimento de Dígitos</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-4">Reconhecimento de Dígitos</h1>
        <canvas id="drawCanvas" width="280" height="280" style="border: 1px solid #000;"></canvas>
        <div class="mt-3">
            <button id="clearButton" class="btn btn-secondary mr-2">Limpar</button>
            <button id="submitButton" class="btn btn-primary">Enviar</button>
        </div>
        <h3 class="mt-4">Resultado:</h3>
        <p id="result" class="mt-2"></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        const canvas = document.getElementById('drawCanvas');
        const context = canvas.getContext('2d');
        let isDrawing = false;
        
        // Inicialização do canvas
        context.lineWidth = 20;
        context.lineCap = 'round';
        context.strokeStyle = 'black';

        // Variável para armazenar a matriz 28x28 do desenho
        let matrix = Array(28).fill().map(() => Array(28).fill(0));

        // Função para atualizar a matriz a partir do desenho
        function updateMatrix() {
            const imgData = context.getImageData(0, 0, 280, 280);
            for (let i = 0; i < 280; i += 10) {
                for (let j = 0; j < 280; j += 10) {
                    let sum = 0;
                    for (let x = 0; x < 10; x++) {
                        for (let y = 0; y < 10; y++) {
                            const index = ((j + y) * 280 + i + x) * 4;
                            sum += imgData.data[index] > 0 ? 1 : 0;
                        }
                    }
                    const value = sum / 100; // Normalização
                    const row = Math.floor(j / 10);
                    const col = Math.floor(i / 10);
                    matrix[row][col] = value;
                }
            }
        }

        // Função para limpar o canvas
        $('#clearButton').click(function () {
            context.clearRect(0, 0, canvas.width, canvas.height);
            matrix = Array(28).fill().map(() => Array(28).fill(0));
        });

        // Função para submeter o desenho e calcular o número
        $('#submitButton').click(function () {
            updateMatrix();
            // Enviar a matriz 'matrix' para sua rede neural e exibir o resultado
            // Implemente sua lógica de reconhecimento de dígitos aqui.
            const result = 'Número reconhecido: ...'; // Substitua pelo resultado real.
            $('#result').text(result);
        });

        // Lógica de desenho no canvas
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            context.beginPath();
            context.moveTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                context.lineTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
                context.stroke();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        canvas.addEventListener('mouseout', () => {
            isDrawing = false;
        });
    </script>
</body>
</html>
